# ─── Worker ────────────────────────────────────────────────────────────
name = "latex-on-http"
main = "src/index.ts"
compatibility_date = "2025-04-01"

# Required when you have multiple Cloudflare accounts.
account_id = "47bdce30e4337b94e234ac9b31aee19f"

# ─── Observability ─────────────────────────────────────────────────────
# Enable Workers Observability for logging, metrics, and debugging
[observability]
enabled = true

# ─── Container ─────────────────────────────────────────────────────────
# Wrangler builds the Docker image locally and pushes it to Cloudflare's
# registry on `wrangler deploy`.
#
# image             → path to the Dockerfile (relative to this file)
# image_build_context → Docker build context (relative to this file);
#                       must be the repo root so COPY app.py / latexonhttp/ works.
# instance_type     → "standard-2" gives more vCPU, RAM, and disk than standard-1.
#                     standard-1 (8 GB disk) was too small for the unpacked image.
# max_instances     → cap on simultaneously running containers.

[[containers]]
class_name = "LatexContainer"
image = "../Dockerfile"
image_build_context = "../../.."
instance_type = "standard-2"
max_instances = 5

# ─── Durable Object binding ───────────────────────────────────────────
# The Worker uses this binding (env.LATEX_CONTAINER) to route requests
# to container instances.

[[durable_objects.bindings]]
name = "LATEX_CONTAINER"
class_name = "LatexContainer"

# ─── Migration ─────────────────────────────────────────────────────────
# Required on first deploy. Creates the Durable Object storage.
# MUST be new_sqlite_classes (not new_classes) for containers.

[[migrations]]
tag = "v1"
new_sqlite_classes = ["LatexContainer"]
